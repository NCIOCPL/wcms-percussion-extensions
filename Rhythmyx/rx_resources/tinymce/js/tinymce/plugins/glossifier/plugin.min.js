var cGovReq,cGovOriginalData,cGovMassagedData,cGovUniqueId,cGovEditorName,cGovStatusWindow,cGovCheckboxWindow,_glossifyEditor,cGovCRConst="&#x000d;",cGovLFConst="&#x000a;",cGovWebServiceURL="/GlossifierProxy/services/GlossifierProxy.GlossifierSoap/",cGovPreviewURL="www.cancer.gov",cGovElementPrefix="ns1",cGovSoapPrefix="soapenv",cGovSoapNameSpace="http:?/?/?schemas.xmlsoap.org/?soap/?envelope/",cGovWSNameSpace="cancer.gov/glossproxy",cGovSoapMethod="cancer.gov/glossproxy/glossify",cGovIsEnglish=!0,cGovLanguage=document.documentElement.lang.split("-")[0],$body=jQuery("body");function cGovTinyMCEGlossify(e){cGovMassagedData=cGovPrepareStr(e);var o="<?xml version=\"1.0\"?><soapenv:Envelope xmlns:soapenv='http://schemas.xmlsoap.org/soap/envelope/' xmlns:m='"+cGovWSNameSpace+"'> <soapenv:Header/><soapenv:Body><m:glossify><m:fragment>"+("<![CDATA["+cGovMassagedData+"]]>")+"</m:fragment><m:dictionaries><m:string>Cancer.gov</m:string></m:dictionaries><m:languages><m:string>"+cGovLanguage+"</m:string></m:languages></m:glossify></soapenv:Body></soapenv:Envelope>";cGovReq=new XMLHttpRequest;return $body.append('<div id="loading-html" class="gloss-modal"><link href="../rx_resources/tinymce/js/tinymce/plugins/glossifier/css/glossify.css" rel="stylesheet" /><script language="javascript" type="text/javascript">var prg_width = 200;function progress() {var node = document.getElementById("progress");if(node != null) {var w = node.style.width.match(/\\d+/);if (w == prg_width) {w = 0;}node.style.width = parseInt(w) + 5 + "px";}}setInterval(progress, 250);<\/script><div class="gloss-modal-content"><button type="button" class="gloss-close" /><div class="border-box" ><div id="progress" style="background-color:red;width:0px;height:10px;"/></div><h2>Processing document, please wait........</h2></div></div>'),$(".gloss-modal-content").draggable(),$(".gloss-close").click(function(){closeGlossifier()}),cGovReq.onreadystatechange=cGovProcessReqChange,cGovReq.open("POST",cGovWebServiceURL,!0),cGovReq.setRequestHeader("Content-Type","text/xml; charset=utf-8"),cGovReq.setRequestHeader("SOAPAction",cGovSoapMethod),cGovReq.send(o),!0}function cGovProcessReqChange(){if(4==cGovReq.readyState&&200==cGovReq.status){var e=cGovBuildTermsArray(getElementsByTagNameNS(getElementsByTagNameNS(getElementsByTagNameNS(getElementsByTagNameNS(getElementsByTagNameNS(cGovReq.responseXML,cGovSoapNameSpace,cGovSoapPrefix,"Envelope")[0],cGovSoapNameSpace,cGovSoapPrefix,"Body")[0],cGovWSNameSpace,cGovElementPrefix,"glossifyResponse")[0],cGovWSNameSpace,cGovElementPrefix,"glossifyResult")[0],cGovWSNameSpace,cGovElementPrefix,"Term")),o='<div id="massaged-data">Data element - you should not see this.</div><div id="checkbox-html" class="gloss-modal"><link href="../rx_resources/tinymce/js/tinymce/plugins/glossifier/css/glossify.css" rel="stylesheet" /><script language="Javascript">$( \'input[name="terms"]\' ).change(function() {returnChecks()});function returnChecks() {var myCheckArr = [];var checkedItem = $(\'#Glossify\').contents().find(\'input[name="terms"]\' + \':checked\');checkedItem.each(function() {$this = $(this);myCheckArr.push($this.attr("value"));});$("#massaged-data").attr("data-checked-array", myCheckArr);}<\/script><div name="Glossify" id="Glossify" class="gloss-modal-content"><button type="button" class="gloss-close" /><h1>Glossifier tool</h1><h2>Please check/uncheck the word(s) you want glossified</h2><hr>'+(cGovMassagedData=cGovBuildCBDisplayString(cGovMassagedData,e))+'<hr><button name="gloss-sumbit" type="button" value="Submit Changes">Submit Changes</button></div></div>';$("#loading-html").remove(),$body.append(o),$("#Glossify").draggable(),setClickEvents()}}function setClickEvents(){$(".gloss-close").click(function(){closeGlossifier()}),$('[name="gloss-sumbit"]').click(function(){submitContent(buildCheckArray($("#massaged-data").attr("data-checked-array"))),closeGlossifier()})}function submitContent(e){var o=new RegExp("<input type=checkbox name=terms.+?value=.+?>"),s=new RegExp('<a __(?:new|old)term="(.+?)"(.+?)>(.+?)</a>'),t=new RegExp('<font __type="glossifyTemp".+?>(.+?)</font>'),n=new RegExp(cGovCRConst),a=new RegExp(cGovLFConst),i=cGovStripCheckboxes(o,cGovMassagedData);i=cGovFixCRLF(a,i=cGovFixCRLF(n,i=cGovKillFonts(t,i=cGovFixFinalLinks(s,i,e)),"\r"),"\n"),_glossifyEditor.setContent(i)}function termObject(){this.start=0,this.length=0,this.docId="",this.dictionary="",this.language="",this.first=!0}function getElementsByTagNameNS(e,o,s,t){return elements=e.getElementsByTagName(s+":"+t),0==elements.length&&(elements=e.getElementsByTagName(t)),0==elements.length&&(elements=e.getElementsByTagNameNS(o,t)),elements}function buildCheckArray(e){if(void 0!==e)return e.split(",");closeGlossifier()}function closeGlossifier(){cGovReq&&cGovReq.abort(),$("#checkbox-html, #loading-html, #massaged-data").remove()}function cGovStripCheckboxes(e,o){for(var s=!1,t=0;!s;){var n=o.substr(t);if(null==n)s=!0;else{var a=e.exec(n);null==a?s=!0:(t+=a.index,o=o.replace(a[0],""))}}return o}function cGovFixFinalLinks(e,o,s){for(var t=!1,n=0;!t;){var a=o.substr(n);if(null==a)t=!0;else{var c=e.exec(a);if(null==c)t=!0;else{n+=c.index;var r=!1;for(i=0;i<s.length;i++)if(s[i]==c[1]){r=!0;break}r?o=o.replace(c[0],"<a "+c[2]+">"+c[3]+"</a>"):(o=o.replace(c[0],c[3]),n+=c[3].length)}}}return o}function cGovKillFonts(e,o){for(var s=!1,t=0;!s;){var n=o.substr(t);if(null==n)s=!0;else{var a=e.exec(n);null==a?s=!0:(t+=a.index,o=o.replace(a[0],a[1]))}}return o}function cGovFixCRLF(e,o,s){for(var t=!1,n=0;!t;){var a=o.substr(n);if(null==a)t=!0;else{var i=e.exec(a);null==i?t=!0:(n+=i.index,o=o.replace(i[0],s))}}return o}function cGovBuildTermsArray(e){var o=[];for(i=0;i<e.length;i++){var s=new termObject,t=getElementsByTagNameNS(e[i],cGovWSNameSpace,cGovElementPrefix,"start");s.start=t[0].childNodes[0].nodeValue;var n=getElementsByTagNameNS(e[i],cGovWSNameSpace,cGovElementPrefix,"length");s.length=n[0].childNodes[0].nodeValue;var a=getElementsByTagNameNS(e[i],cGovWSNameSpace,cGovElementPrefix,"docId");s.docId=a[0].childNodes[0].nodeValue;var c=getElementsByTagNameNS(e[i],cGovWSNameSpace,cGovElementPrefix,"dictionary");s.dictionary=c[0].childNodes[0].nodeValue;var r=getElementsByTagNameNS(e[i],cGovWSNameSpace,cGovElementPrefix,"language");s.language=r[0].childNodes[0].nodeValue;var l=getElementsByTagNameNS(e[i],cGovWSNameSpace,cGovElementPrefix,"firstOccurrence");s.first=l[0].childNodes[0].nodeValue,o[i]=s}return o}function cGovBuildCBDisplayString(e,o){for(i=o.length-1;i>=0;i--){var s=o[i];cGovUniqueId++;var t,n=e.substr(0,parseInt(s.start)),a=e.substr(parseInt(s.start),parseInt(s.length)),c=e.substr(parseInt(s.start)+parseInt(s.length));t="es"==cGovLanguage?"Spanish":"English",e=n+"<input type=checkbox name=terms value="+cGovUniqueId+'><a __newterm="'+cGovUniqueId+'" class="definition" href="/Common/PopUps/popDefinition.aspx?id='+s.docId+"&version=Patient&language="+t+"\" onclick=\"javascript:popWindow('defbyid','"+s.docId+"&version=Patient&language="+t+"'); return false;\">"+a+"</a>"+c}return e=cGovDoRegExpFonts(new RegExp('<a __(?:new|old)term=".+?>(.+?)</a>'),e),rxOldterm=new RegExp('<a __oldterm="(.+?)"'),e=cGovDoRegExpAddChecks(rxOldterm,e)}function cGovPrepareStr(e){var o=e,s="",t=new RegExp('<a\\s+(class="definition".+?>.+?</a>)'),n=new RegExp('<a\\s+(onclick="javascript:popWindow.+?href=.+?dictionary/db_alpha.aspx.+?</a>)',"i"),a=new RegExp('<a\\s+(onclick="javascript:popWindow.+?href=.+?popDefinition.aspx.+?</a>)');o=cGovDoRegExp1(new RegExp('<a\\s+(href="/Common/PopUps/popDefinition.aspx.+?</a>)'),o=cGovDoRegExp1(t,o=cGovDoRegExp1(a,o=cGovDoRegExp1(n,o))));for(var i=0;i<o.length;i++){var c=o.charAt(i);s+="\n"==c?cGovLFConst:"\r"==c?cGovCRConst:"”"==c?"&#148;":"—"==c?"&#151;":"–"==c?"&#150;":"Á"==c?"&#193;":"Í"==c?"&#205;":c}return s}function cGovDoRegExp1(e,o){for(var s=!1,t=0;!s;){var n=o.substr(t);if(null==n)s=!0;else{var a=e.exec(n);if(null==a)s=!0;else{t+=a.index;var i=cGovAddUniqueID(a[1]);o=o.replace(a[0],i),t+=i.length}}}return o}function cGovDoRegExpAddChecks(e,o){for(var s=!1,t=0;!s;){var n=o.substr(t);if(null==n)s=!0;else{var a=e.exec(n);if(null==a)s=!0;else{t+=a.index;var i="<input type=checkbox name=terms checked value="+a[1]+">"+a[0];o=o.replace(a[0],i),t+=i.length}}}return o}function cGovDoRegExpFonts(e,o){for(var s,t=!1,n=0,a=[];!t;){var i=o.substr(n),c=o.substr(0,n);if(null==i)t=!0;else{var r=e.exec(i);if(null==r)t=!0;else{var l=!1;for(j=0;j<a.length;j++)if(a[j]==r[1].toLowerCase()){l=!0;break}l?n+=r.index+r[0].length:(a.push(r[1].toLowerCase()),s='<font __type="glossifyTemp" style="background-color: #ffff00;">'+r[1]+"</font>",i=i.replace(r[1],s),n+=r.index+r[0].length+s.length-r[1].length),o=c+i}}}return o}function cGovAddUniqueID(e){return'<a __oldterm="'+ ++cGovUniqueId+'" '+e}function fixSpanish(e){var o=e;return o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=o.split("&Aacute;").join("Á")).split("&aacute;").join("á")).split("&Eacute;").join("É")).split("&eacute;").join("é")).split("&Iacute;").join("Í")).split("&iacute;").join("í")).split("&Oacute;").join("Ó")).split("&oacute;").join("ó")).split("&Uacute;").join("Ú")).split("&uacute;").join("ú")).split("&Yacute;").join("Ý")).split("&yacute;").join("ý")).split("&Ntilde;").join("Ñ")).split("&ntilde;").join("ñ")}tinymce.PluginManager.add("glossifier",function(e){var o=e.settings,s="";e.addCommand("openGlossifier",function(){s=fixSpanish(s=e.getContent()),cGovUniqueId=0,cGovLanguage="es"==o.language?o.language:"en",_glossifyEditor=e,closeGlossifier(),cGovTinyMCEGlossify(s)}),e.addButton("glossifier",{icon:'glossifier" style="background-image:url(\'../rx_resources/tinymce/images/glossify.gif\');"',title:"Glossify",cmd:"openGlossifier"}),e.addMenuItem("glossifier",{icon:'glossifier" style="background-image:url(\'../rx_resources/tinymce/images/glossify.gif\');"',text:"Glossify",cmd:"openGlossifier",context:"tools"})});