var cGovReq,cGovOriginalData,cGovMassagedData,cGovUniqueId,cGovEditorName,cGovStatusWindow,cGovCheckboxWindow,_glossifyEditor,cGovCRConst="&#x000d;",cGovLFConst="&#x000a;",cGovWebServiceURL="/GlossifierProxy/services/GlossifierProxy.GlossifierSoap/",cGovPreviewURL="www.cancer.gov",cGovElementPrefix="ns1",cGovSoapPrefix="soapenv",cGovSoapNameSpace="http:?/?/?schemas.xmlsoap.org/?soap/?envelope/",cGovWSNameSpace="cancer.gov/glossproxy",cGovSoapMethod="cancer.gov/glossproxy/glossify",cGovIsEnglish=!0,cGovLanguage=document.documentElement.lang.split("-")[0],$body=jQuery("body");function cGovTinyMCEGlossify(e){cGovMassagedData=cGovPrepareStr(e);var a="<?xml version=\"1.0\"?><soapenv:Envelope xmlns:soapenv='http://schemas.xmlsoap.org/soap/envelope/' xmlns:m='"+cGovWSNameSpace+"'> <soapenv:Header/><soapenv:Body><m:glossify><m:fragment>"+("<![CDATA["+cGovMassagedData+"]]>")+"</m:fragment><m:dictionaries><m:string>Cancer.gov</m:string></m:dictionaries><m:languages><m:string>"+cGovLanguage+"</m:string></m:languages></m:glossify></soapenv:Body></soapenv:Envelope>";cGovReq=new XMLHttpRequest;return $body.append('<div id="loading-html"><style type="text/css">H2 {COLOR: #333366; FONT-FAMILY: Trebuchet MS, Tahoma, Verdana, Arial, sans-serif; FONT-SIZE: 12px; FONT-WEIGHT: bold; LINE-HEIGHT: 14px}</style><script language="javascript" type="text/javascript">var prg_width = 200;function progress() {var node = document.getElementById("progress");var w = node.style.width.match(/\\d+/);if (w == prg_width) {w = 0;}node.style.width = parseInt(w) + 5 + "px";}setInterval(progress, 250);<\/script><h1>GlossifyDocumentPrep</h1><div><div style="border: 1px solid black; width:200px; height:10px;"><div id="progress" style="height:10px; width:0px; background-color:red;"/></div></div><h2>Processing document, please wait........</h2></div>'),cGovReq.onreadystatechange=cGovProcessReqChange,cGovReq.open("POST",cGovWebServiceURL,!0),cGovReq.setRequestHeader("Content-Type","text/xml; charset=utf-8"),cGovReq.setRequestHeader("SOAPAction",cGovSoapMethod),cGovReq.send(a),!0}function termObject(){this.start=0,this.length=0,this.docId="",this.dictionary="",this.language="",this.first=!0}function getElementsByTagNameNS(e,a,t,n){return elements=e.getElementsByTagName(t+":"+n),0==elements.length&&(elements=e.getElementsByTagName(n)),0==elements.length&&(elements=e.getElementsByTagNameNS(a,n)),elements}function cGovProcessReqChange(){if(4==cGovReq.readyState&&200==cGovReq.status){var e=cGovBuildTermsArray(getElementsByTagNameNS(getElementsByTagNameNS(getElementsByTagNameNS(getElementsByTagNameNS(getElementsByTagNameNS(cGovReq.responseXML,cGovSoapNameSpace,cGovSoapPrefix,"Envelope")[0],cGovSoapNameSpace,cGovSoapPrefix,"Body")[0],cGovWSNameSpace,cGovElementPrefix,"glossifyResponse")[0],cGovWSNameSpace,cGovElementPrefix,"glossifyResult")[0],cGovWSNameSpace,cGovElementPrefix,"Term")),a='<div id="massaged-data" style="display:inline;">Data element - you should not see this.</div><div id="checkbox-html"><style type="text/css">H2 {COLOR: #333366; FONT-FAMILY: Trebuchet MS, Tahoma, Verdana, Arial, sans-serif; FONT-SIZE: 12px; FONT-WEIGHT: bold; LINE-HEIGHT: 14px}</style><script language="Javascript">$( \'input[name="terms"]\' ).change(function() {returnChecks()});function returnChecks() {doMore();}function doMore() {var myCheckArr = [];var checkedItem = $(\'#Glossify\').contents().find(\'input[name="terms"]\' + \':checked\');checkedItem.each(function() {$this = $(this);myCheckArr.push($this.attr("value"));});$("#massaged-data").attr("data-checked-array", myCheckArr);alert(myCheckArr);}<\/script><div name="Glossify" id="Glossify"><h2>Please check/uncheck the word(s) you want glossified</h2><hr>'+(cGovMassagedData=cGovBuildCBDisplayString(cGovMassagedData,e))+'<hr><button name="gloss-sumbit" type="button" value="Submit Changes">Submit Changes</button></div></div>';$("#loading-html").remove(),$body.append(a),$('[name="gloss-sumbit"]').click(function(){submitter(buildCheckArray($("#massaged-data").attr("data-checked-array")))})}}function buildCheckArray(e){return e.split(",")}function submitter(e){var a=new RegExp("<input type=checkbox name=terms.+?value=.+?>"),t=new RegExp('<a __(?:new|old)term="(.+?)"(.+?)>(.+?)</a>'),n=new RegExp('<font __type="glossifyTemp".+?>(.+?)</font>'),o=new RegExp(cGovCRConst),s=new RegExp(cGovLFConst),i=cGovStripCheckboxes(a,cGovMassagedData);i=cGovFixCRLF(s,i=cGovFixCRLF(o,i=cGovKillFonts(n,i=cGovFixFinalLinks(t,i,e)),"\r"),"\n"),_glossifyEditor.setContent(i)}function cGovStripCheckboxes(e,a){for(var t=!1,n=0;!t;){var o=a.substr(n);if(null==o)t=!0;else{var s=e.exec(o);null==s?t=!0:(n+=s.index,a=a.replace(s[0],""))}}return a}function cGovFixFinalLinks(e,a,t){for(var n=!1,o=0;!n;){var s=a.substr(o);if(null==s)n=!0;else{var r=e.exec(s);if(null==r)n=!0;else{o+=r.index;var c=!1;for(i=0;i<t.length;i++)if(t[i]==r[1]){c=!0;break}c?a=a.replace(r[0],"<a "+r[2]+">"+r[3]+"</a>"):(a=a.replace(r[0],r[3]),o+=r[3].length)}}}return a}function cGovKillFonts(e,a){for(var t=!1,n=0;!t;){var o=a.substr(n);if(null==o)t=!0;else{var s=e.exec(o);null==s?t=!0:(n+=s.index,a=a.replace(s[0],s[1]))}}return a}function cGovFixCRLF(e,a,t){for(var n=!1,o=0;!n;){var s=a.substr(o);if(null==s)n=!0;else{var i=e.exec(s);null==i?n=!0:(o+=i.index,a=a.replace(i[0],t))}}return a}function cGovBuildTermsArray(e){var a=[];for(i=0;i<e.length;i++){var t=new termObject,n=getElementsByTagNameNS(e[i],cGovWSNameSpace,cGovElementPrefix,"start");t.start=n[0].childNodes[0].nodeValue;var o=getElementsByTagNameNS(e[i],cGovWSNameSpace,cGovElementPrefix,"length");t.length=o[0].childNodes[0].nodeValue;var s=getElementsByTagNameNS(e[i],cGovWSNameSpace,cGovElementPrefix,"docId");t.docId=s[0].childNodes[0].nodeValue;var r=getElementsByTagNameNS(e[i],cGovWSNameSpace,cGovElementPrefix,"dictionary");t.dictionary=r[0].childNodes[0].nodeValue;var c=getElementsByTagNameNS(e[i],cGovWSNameSpace,cGovElementPrefix,"language");t.language=c[0].childNodes[0].nodeValue;var l=getElementsByTagNameNS(e[i],cGovWSNameSpace,cGovElementPrefix,"firstOccurrence");t.first=l[0].childNodes[0].nodeValue,a[i]=t}return a}function cGovBuildCBDisplayString(e,a){for(i=a.length-1;i>=0;i--){var t=a[i];cGovUniqueId++;var n,o=e.substr(0,parseInt(t.start)),s=e.substr(parseInt(t.start),parseInt(t.length)),r=e.substr(parseInt(t.start)+parseInt(t.length));n="es"==cGovLanguage?"Spanish":"English",e=o+"<input type=checkbox name=terms value="+cGovUniqueId+'><a __newterm="'+cGovUniqueId+'" class="definition" href="/Common/PopUps/popDefinition.aspx?id='+t.docId+"&version=Patient&language="+n+"\" onclick=\"javascript:popWindow('defbyid','"+t.docId+"&version=Patient&language="+n+"'); return false;\">"+s+"</a>"+r}return e=cGovDoRegExpFonts(new RegExp('<a __(?:new|old)term=".+?>(.+?)</a>'),e),rxOldterm=new RegExp('<a __oldterm="(.+?)"'),e=cGovDoRegExpAddChecks(rxOldterm,e)}function cGovPrepareStr(e){var a=e,t="",n=new RegExp('<a\\s+(class="definition".+?>.+?</a>)'),o=new RegExp('<a\\s+(onclick="javascript:popWindow.+?href=.+?dictionary/db_alpha.aspx.+?</a>)',"i"),s=new RegExp('<a\\s+(onclick="javascript:popWindow.+?href=.+?popDefinition.aspx.+?</a>)');a=cGovDoRegExp1(new RegExp('<a\\s+(href="/Common/PopUps/popDefinition.aspx.+?</a>)'),a=cGovDoRegExp1(n,a=cGovDoRegExp1(s,a=cGovDoRegExp1(o,a))));for(var i=0;i<a.length;i++){var r=a.charAt(i);t+="\n"==r?cGovLFConst:"\r"==r?cGovCRConst:"”"==r?"&#148;":"—"==r?"&#151;":"–"==r?"&#150;":"Á"==r?"&#193;":"Í"==r?"&#205;":r}return t}function cGovDoRegExp1(e,a){for(var t=!1,n=0;!t;){var o=a.substr(n);if(null==o)t=!0;else{var s=e.exec(o);if(null==s)t=!0;else{n+=s.index;var i=cGovAddUniqueID(s[1]);a=a.replace(s[0],i),n+=i.length}}}return a}function cGovDoRegExpAddChecks(e,a){for(var t=!1,n=0;!t;){var o=a.substr(n);if(null==o)t=!0;else{var s=e.exec(o);if(null==s)t=!0;else{n+=s.index;var i="<input type=checkbox name=terms checked value="+s[1]+">"+s[0];a=a.replace(s[0],i),n+=i.length}}}return a}function cGovDoRegExpFonts(e,a){for(var t,n=!1,o=0,s=[];!n;){var i=a.substr(o),r=a.substr(0,o);if(null==i)n=!0;else{var c=e.exec(i);if(null==c)n=!0;else{var l=!1;for(j=0;j<s.length;j++)if(s[j]==c[1].toLowerCase()){l=!0;break}l?o+=c.index+c[0].length:(s.push(c[1].toLowerCase()),t='<font __type="glossifyTemp" style="background-color: #ffff00;">'+c[1]+"</font>",i=i.replace(c[1],t),o+=c.index+c[0].length+t.length-c[1].length),a=r+i}}}return a}function cGovAddUniqueID(e){return'<a __oldterm="'+ ++cGovUniqueId+'" '+e}function fixSpanish(e,a,t){return e.split(a).join(t)}tinymce.PluginManager.add("glossifier",function(e){var a=e.settings,t="";e.addCommand("openGlossifier",function(){t=fixSpanish(t=fixSpanish(t=fixSpanish(t=fixSpanish(t=fixSpanish(t=fixSpanish(t=fixSpanish(t=fixSpanish(t=fixSpanish(t=fixSpanish(t=fixSpanish(t=fixSpanish(t=fixSpanish(t=fixSpanish(t=e.getContent(),"&Aacute;","Á"),"&aacute;","á"),"&Eacute;","É"),"&eacute;","é"),"&Iacute;","Í"),"&iacute;","í"),"&Oacute;","Ó"),"&oacute;","ó"),"&Uacute;","Ú"),"&uacute;","ú"),"&Yacute;","Ý"),"&yacute;","ý"),"&Ntilde;","Ñ"),"&ntilde;","ñ"),cGovUniqueId=0,cGovLanguage="es"==a.language?a.language:"en",_glossifyEditor=e,$("#checkbox-html, #loading-html, #massaged-data").remove(),cGovTinyMCEGlossify(t)}),e.addButton("glossifier",{icon:'glossifier" style="background-image:url(\'../rx_resources/tinymce/images/glossify.gif\');"',title:"Glossify",cmd:"openGlossifier"}),e.addMenuItem("glossifier",{icon:'glossifier" style="background-image:url(\'../rx_resources/tinymce/images/glossify.gif\');"',text:"Glossify",cmd:"openGlossifier",context:"tools"})});